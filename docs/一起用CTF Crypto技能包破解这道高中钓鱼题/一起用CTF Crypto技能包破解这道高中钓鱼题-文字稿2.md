当然可以啦！
这几天终于装好了SageMath
刚好虐一道有名的高中钓鱼题助助兴
这道钓鱼题的来历可能是
兰那罗想问一道常规的高中数学题
但是抄漏了一个系数
于是成功把一道常规题变成一道很难求出结果的题
首先，我们会讲讲为什么去掉一个系数后，题目反而变难了
接下来，我们会用高中生也能轻松听懂的语言
讲解这期视频用到的高等数学工具：拉格朗日乘数法和Gröbner基
最后，我们会用SageMath写代码，轻松求出这题的解析解

这题还有柯西不等式+待定系数法等很多做法
这里我选择从三角换元+万能公式做法切入，足够无脑
首先，我们设x=cosine θ，y=sine θ，展开式子
我们会发现这里不方便用三角变换技能包
于是我们考虑用万能公式来消元
这样我们就得到一个分式函数，上面是二次的，下面是四次的
常规动作，求导，分母是正的，我们只需要关注分子
发现分子里有一个3次函数
这个3次方程有一个解可以试出来，是二分之一
于是我们可以进行多项式除法，除以2t-1，得到二次方程
这样我们就得到了函数的所有极值点
用穿针引线法不难画出这个3次函数的图像
进而想象出原函数的图像
发现负4减根号11和二分之一是那个分式函数的两个极大值点
求这两个极大值点哪个大就OK
最后算出在二分之一处取到最大值
而且我们发现，x、y的值都是比较优美的，五分之三和五分之四

我们对钓鱼题做同样的操作
得到导数的分子也是一个3次函数
但这个3次方程在实数域只有一个根，而且它不能手算试出来
这道钓鱼题的做法有很多，但多尝试几种不同做法后会发现
无论什么做法，最后都必须解一个很难解的3次方程
命题人需要精心挑选系数，来让这个3次方程的解能够手算得到
才能出一道类似的高考模拟题
绝大多数情况下，都无法手算求解这种问题，需要考虑写代码

在写代码之前，我们需要介绍些高等数学工具
我仔细挑选了理解代码所需的最少知识
高中生应该是能轻松听懂的
首先，我们介绍拉格朗日乘数法
这个算是备战高考的热门知识点了
虽然超纲，但应该有很多高中生学过
这道钓鱼题在微积分里叫条件极值问题
条件极值问题有两大要素：
约束条件，或者说约束方程，和目标函数
千言万语不如一个例子
相信同学们能自己扩展到一般情况
假设有两个变量x、y，两个约束条件phi1、phi2和目标函数f
我们构造拉格朗日函数大F，它有2+2=4个变量
再令它对这4个变量的偏导都为0，就得到屏幕中间的4个方程
其中两个就是原来的约束条件，还有两个是新得到的方程
解这个方程组得到一系列的x和y
一般来说解集都包含所有的极值点，当然还可能包含一些驻点
这和高中学过的对一元函数求导的情况类似
当然，有些比较刁钻的情况，拉格朗日乘数法会漏掉极值点
本期视频不涉及这些刁钻的情况，读了大学再慢慢接触吧

接下来我们用拉格朗日乘数法处理下这道钓鱼题
构造拉格朗日函数，它引入了1个新变量
令它对这3个变量的偏导都为0，得到屏幕里展示的方程组
写代码求这个方程组的数值解很简单
如果是用SageMath，直接把方程组扔进solve函数就行
但为了求解析解，我们需要先完成消元
实际上，前面讲的三角换元+万能公式就是其中一种手算消元方法
现在，希望写代码自动对刚刚得到的方程组进行消元
这就需要引入下一个数学工具了

接下来非常粗略地介绍Gröbner基
这是代数几何的一个工具，学习难度对高中生来说很大
但幸好这期视频只需要对它建立一个感性印象
我们观察上一页得到的方程组
发现它的每一项都可以写成系数乘x的幂乘y的幂
我们把这些项叫做“单项式”，单项式加起来就叫多元多项式
接下来我们回顾一下线性方程组是怎么解的
用高斯消元法把线性方程组变成上三角形式
比如屏幕里的例子，第二条式子只剩一个变量y
方程组也就能轻松解出了
我们希望多元多项式方程组也能完成类似的消元过程
Gröbner基就能做这件事

为了看懂代码，我们需要类比Gröbner基和线性空间的基
这里会涉及一些简单的线性代数
但没关系，我们只需要建立感性印象，足够看懂代码就行
我们在高中学过平面向量和空间向量
在平面里，我们通常用1逗0和0逗1这两个单位向量表示平面内所有向量
我们说这两个向量是2维线性空间的一组基
也可以说这组基生成了2维线性空间
为什么用单位向量呢？
其他向量不行吗？
实际上，任意两个不共线的向量都可以表示平面内所有向量
比如11逗45和14逗11不共线，也可以是一组基
但它的性质没有单位向量“好”，用起来不方便！
现在给你k个向量，里面可能有一些向量是能够用其他向量线性表出的
这些向量对线性空间来说就是多余的
把它们去掉，剩下的向量两两线性无关
那么我们就说它们是一组基
比如，给定11逗45、14逗11和25逗56这3个向量
我们发现v3可以写成前两个向量的和
所以它是多余的，去掉它，剩下的两个向量就是一组基
总之，一组向量总能生成一个线性空间，维数不大于向量个数
现在，把k个向量改成k个多项式，我们说它们生成一个理想
希望在这组多项式生成的理想中找到一些性质“好”的基，完成消元
如果我们能在Gröbner基中找到一元多项式，那就成功完成了消元
如果这个多项式的性质比较好
比如，次数小于等于4
那就能得到方程组的解析解

最后，为了能看懂代码，还需要补充一些必要概念
别看这里字密密麻麻的就被吓到了！
其实，单项式和字典序必知必会，也很容易理解
对于多项式环，就只需要知道抽象代数里有这么个概念
为了实现消元求出Gröbner基的过程
需要规定单项式之间的顺序关系，它会影响消元顺序
规定方式不唯一，这期视频只介绍最容易理解的字典序
依旧千言万语不如一个例子
设单项式k倍x的a次方y的b次方z的c次方
且规定x大于y大于z，就可以写出一个4元组
拿到两个4元组，优先比较a的大小，a大则4元组大
a一样则比较b，b也一样则比较c，以此类推
最下面的代码块是非常好的例子
把玩一下就知道字典序的规则细节了
从左到右、从上到下，单项式就从大到小

接下来简单介绍一下SageMath
它是一款开源的Python数学软件
站在了numpy、sympy等我们耳熟能详的开源巨人的肩膀上
它在Python语法基础上增加了些语法糖，方便书写
安装SageMath比较麻烦，这里先不讲，以后有时间再填坑~
同学们只需要复制屏幕中间的代码去这个sage cell网站运行
就能无痛体验SageMath
点击网页里的Evaluate按钮就能看到结果
如果你和我一样在用Windows
那么你就不得不先折腾WSL和Anaconda
这就是为什么我会鸽这么多天

铺垫了这么多，终于可以看代码了！
很遗憾，万众瞩目的大语言模型没能力一次写出这里展示的代码
所以我的讲解暂时还是有价值的
第一个代码块很短，但已经做了不少事
首先，定义一个三元多项式环，多项式系数都是有理数
并规定单项式按字典序排序，变量t大于x大于y
采用其他排序规则会得到不同的Gröbner基
并不是所有Gröbner基都含有我们感兴趣的消元结果
感兴趣的可以自己试试
接着用多项式环的3个变量定义拉格朗日函数，并求它对每个变量的偏导
然后构造由这三个偏导组成的多项式理想，并求它的Gröbner基
看右边的运行结果，我们发现Gröbner基里的第3个多项式只含y
这表明我们成功用Gröbner基完成了消元
并且，第2个多项式告诉我们，x能用y表示出来
接着看第二段代码，我们先运行一次，看因式分解的结果
发现确实只能直接求3次方程的根
于是继续写出下面那3行代码解方程
方程有两个复数根，第三个根是我们想要的实根
太长了，放到后两页PPT展示了
顺便说下，像屏幕右下角的代码这样调用roots方法
也可以直接求出多项式的解析解
不过roots函数返回的是一个tuple
tuple里有两个元素，第一个是根的表达式，第二个是根的重数

最后讲讲非常容易理解的收尾代码
solve函数返回的是一个Expression对象
只有属于二元关系的Expression对象才能调用lhs和rhs方法
这里我们调用rhs方法就能拿到解析解了
代码里变量x的表达式也是从上一页PPT展示的Gröbner基拿到的
后面4个函数都比较简单、实用
大语言模型也会用，就不细说了
最后顺便吐槽下latex函数的踩坑点
出的字符串有可能在Obsidian合法，但在slidev中不合法
bug原因可能是括号没有完全匹配
我暂时没想到好的解决办法
最后是靠直接问LLM帮我输出相关公式解决的

最后来欣赏下这道钓鱼题的解析解吧！
是的，答案需要专门新开一页来展示
纳西妲，你被吓哭了吗？

最后给出完整代码和探究字典序排序规则的代码
有需要的同学可自取
