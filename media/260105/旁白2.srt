1
00:00:14,667 --> 00:00:15,799
当然可以啦！

2
00:00:15,799 --> 00:00:17,999
这几天终于装好了SageMath

3
00:00:17,999 --> 00:00:20,778
刚好虐一道有名的高中钓鱼题助助兴

4
00:00:20,778 --> 00:00:22,970
这道钓鱼题的来历可能是

5
00:00:22,970 --> 00:00:25,663
兰那罗想问一道常规的高中数学题

6
00:00:25,663 --> 00:00:27,393
但是抄漏了一个系数

7
00:00:27,393 --> 00:00:31,105
于是成功把一道常规题变成一道很难求出结果的题

8
00:00:31,105 --> 00:00:35,355
首先，我们会讲讲为什么去掉一个系数后，题目反而变难了

9
00:00:35,355 --> 00:00:38,759
接下来，我们会用高中生也能轻松听懂的语言

10
00:00:38,759 --> 00:00:43,692
讲解这期视频用到的高等数学工具：拉格朗日乘数法和Gröbner基

11
00:00:43,692 --> 00:00:47,942
最后，我们会用SageMath写代码，轻松求出这题的解析解

12
00:00:47,942 --> 00:00:51,576
这题还有柯西不等式+待定系数法等很多做法

13
00:00:51,576 --> 00:00:55,768
这里我选择从三角换元+万能公式做法切入，足够无脑

14
00:00:55,768 --> 00:01:00,432
首先，我们设x=cos(θ), y=sin(θ)，展开式子

15
00:01:00,432 --> 00:01:03,576
我们会发现这里不方便用三角变换技能包

16
00:01:03,576 --> 00:01:05,970
于是我们考虑用万能公式来消元

17
00:01:05,970 --> 00:01:10,365
这样我们就得到一个分式函数，上面是二次的，下面是四次的

18
00:01:10,365 --> 00:01:14,317
常规动作，求导，分母是正的，我们只需要关注分子

19
00:01:14,317 --> 00:01:16,547
发现分子里有一个3次函数

20
00:01:16,547 --> 00:01:20,009
这个3次方程有一个解可以试出来，是1/2

21
00:01:20,009 --> 00:01:24,413
于是我们可以进行多项式除法，除以2t-1，得到二次方程

22
00:01:24,413 --> 00:01:26,932
这样我们就得到了函数的所有极值点

23
00:01:26,932 --> 00:01:30,336
用穿针引线法不难画出这个3次函数的图像

24
00:01:30,336 --> 00:01:32,336
进而想象出原函数的图像

25
00:01:32,336 --> 00:01:37,057
发现-4-√11和1/2是那个分式函数的两个极大值点

26
00:01:37,057 --> 00:01:39,701
求这两个极大值点哪个大就OK

27
00:01:39,701 --> 00:01:42,605
最后算出在1/2处取到最大值

28
00:01:42,605 --> 00:01:47,605
而且我们发现，x、y的值都是比较优美的，3/5和4/5

29
00:01:47,605 --> 00:01:49,720
我们对钓鱼题做同样的操作

30
00:01:49,720 --> 00:01:52,403
得到导数的分子也是一个3次函数

31
00:01:52,403 --> 00:01:57,249
但这个3次方程在实数域只有一个根，而且它不能手算试出来

32
00:01:57,249 --> 00:02:01,615
这道钓鱼题的做法有很多，但多尝试几种不同做法后会发现

33
00:02:01,615 --> 00:02:05,422
无论什么做法，最后都必须解一个很难解的3次方程

34
00:02:05,422 --> 00:02:10,163
命题人需要精心挑选系数，来让这个3次方程的解能够手算得到

35
00:02:10,163 --> 00:02:12,432
才能出一道类似的高考模拟题

36
00:02:12,432 --> 00:02:16,845
绝大多数情况下，都无法手算求解这种问题，需要考虑写代码

37
00:02:16,845 --> 00:02:20,201
在写代码之前，我们需要介绍些高等数学工具

38
00:02:20,201 --> 00:02:23,278
我仔细挑选了理解代码所需的最少知识

39
00:02:23,278 --> 00:02:25,653
高中生应该是能轻松听懂的

40
00:02:25,653 --> 00:02:28,384
首先，我们介绍拉格朗日乘数法

41
00:02:28,384 --> 00:02:30,922
这个算是备战高考的热门知识点了

42
00:02:30,922 --> 00:02:33,759
虽然超纲，但应该有很多高中生学过

43
00:02:33,759 --> 00:02:37,038
这道钓鱼题在微积分里叫条件极值问题

44
00:02:37,038 --> 00:02:39,317
条件极值问题有两大要素：

45
00:02:39,317 --> 00:02:42,740
约束条件，或者说约束方程，和目标函数

46
00:02:42,740 --> 00:02:44,711
千言万语不如一个例子

47
00:02:44,711 --> 00:02:47,595
相信同学们能自己扩展到一般情况

48
00:02:47,595 --> 00:02:52,922
假设有两个变量x、y，两个约束条件phi1、phi2和目标函数f

49
00:02:52,922 --> 00:02:57,124
我们构造拉格朗日函数大F，它有2+2=4个变量

50
00:02:57,124 --> 00:03:01,807
再令它对这4个变量的偏导都为0，就得到屏幕中间的4个方程

51
00:03:01,807 --> 00:03:05,932
其中两个就是原来的约束条件，还有两个是新得到的方程

52
00:03:05,932 --> 00:03:08,759
解这个方程组得到一系列的x和y

53
00:03:08,759 --> 00:03:13,307
一般来说解集都包含所有的极值点，当然还可能包含一些驻点

54
00:03:13,307 --> 00:03:16,701
这和高中学过的对一元函数求导的情况类似

55
00:03:16,701 --> 00:03:21,307
当然，有些比较刁钻的情况，拉格朗日乘数法会漏掉极值点

56
00:03:21,307 --> 00:03:25,730
本期视频不涉及这些刁钻的情况，读了大学再慢慢接触吧

57
00:03:25,730 --> 00:03:29,451
接下来我们用拉格朗日乘数法处理下这道钓鱼题

58
00:03:29,451 --> 00:03:32,480
构造拉格朗日函数，它引入了1个新变量

59
00:03:32,480 --> 00:03:36,768
令它对这3个变量的偏导都为0，得到屏幕里展示的方程组

60
00:03:36,768 --> 00:03:39,711
写代码求这个方程组的数值解很简单

61
00:03:39,711 --> 00:03:43,653
如果是用SageMath，直接把方程组扔进solve函数就行

62
00:03:43,653 --> 00:03:46,576
但为了求解析解，我们需要先完成消元

63
00:03:46,576 --> 00:03:51,634
实际上，前面讲的三角换元+万能公式就是其中一种手算消元方法

64
00:03:51,634 --> 00:03:55,980
现在，希望写代码自动对刚刚得到的方程组进行消元

65
00:03:55,980 --> 00:03:58,249
这就需要引入下一个数学工具了

66
00:03:58,249 --> 00:04:00,817
接下来非常粗略地介绍Gröbner基

67
00:04:00,817 --> 00:04:04,836
这是代数几何的一个工具，学习难度对高中生来说很大

68
00:04:04,836 --> 00:04:08,172
但幸好这期视频只需要对它建立一个感性印象

69
00:04:08,172 --> 00:04:10,470
我们观察上一页得到的方程组

70
00:04:10,470 --> 00:04:14,413
发现它的每一项都可以写成系数乘x的幂乘y的幂

71
00:04:15,388 --> 00:04:19,895
我们把这些项叫做“单项式”，单项式加起来就叫多元多项式

72
00:04:19,895 --> 00:04:23,268
接下来我们回顾一下线性方程组是怎么解的

73
00:04:23,268 --> 00:04:26,990
用高斯消元法把线性方程组变成上三角形式

74
00:04:26,990 --> 00:04:30,605
比如屏幕里的例子，第二条式子只剩一个变量y

75
00:04:30,605 --> 00:04:32,701
方程组也就能轻松解出了

76
00:04:32,701 --> 00:04:36,701
我们希望多元多项式方程组也能完成类似的消元过程

77
00:04:36,701 --> 00:04:38,768
Gröbner基就能做这件事

78
00:04:38,768 --> 00:04:42,817
为了看懂代码，我们需要类比Gröbner基和线性空间的基

79
00:04:42,817 --> 00:04:45,326
这里会涉及一些简单的线性代数

80
00:04:45,326 --> 00:04:49,557
但没关系，我们只需要建立感性印象，足够看懂代码就行

81
00:04:49,557 --> 00:04:52,615
我们在高中学过平面向量和空间向量

82
00:04:52,615 --> 00:04:58,230
在平面里，我们通常用(1,0), (0,1)这两个单位向量表示平面内所有向量

83
00:04:58,230 --> 00:05:01,595
我们说这两个向量是2维线性空间的一组基

84
00:05:01,595 --> 00:05:04,653
也可以说这组基生成了2维线性空间

85
00:05:04,653 --> 00:05:06,355
为什么用单位向量呢？

86
00:05:06,355 --> 00:05:07,836
其他向量不行吗？

87
00:05:07,836 --> 00:05:12,374
实际上，任意两个不共线的向量都可以表示平面内所有向量

88
00:05:12,374 --> 00:05:16,643
比如(11,45), (14,11)不共线，也可以是一组基

89
00:05:16,643 --> 00:05:19,884
但它的性质没有单位向量“好”，用起来不方便！

90
00:05:19,884 --> 00:05:24,942
现在给你k个向量，里面可能有一些向量是能够用其他向量线性表出的

91
00:05:24,942 --> 00:05:27,990
这些向量对线性空间来说就是多余的

92
00:05:27,990 --> 00:05:31,018
把它们去掉，剩下的向量两两线性无关

93
00:05:31,018 --> 00:05:33,153
那么我们就说它们是一组基

94
00:05:33,153 --> 00:05:38,278
比如，给定(11,45), (14,11), (25,56)这3个向量

95
00:05:38,278 --> 00:05:41,317
我们发现v3可以写成前两个向量的和

96
00:05:41,317 --> 00:05:45,663
所以它是多余的，去掉它，剩下的两个向量就是一组基

97
00:05:45,663 --> 00:05:50,547
总之，一组向量总能生成一个线性空间，维数不大于向量个数

98
00:05:50,547 --> 00:05:55,336
现在，把k个向量改成k个多项式，我们说它们生成一个理想

99
00:05:55,336 --> 00:06:00,038
希望在这组多项式生成的理想中找到一些性质“好”的基，完成消元

100
00:06:00,038 --> 00:06:04,672
如果我们能在Gröbner基中找到一元多项式，那就成功完成了消元

101
00:06:04,672 --> 00:06:06,865
如果这个多项式的性质比较好

102
00:06:06,865 --> 00:06:08,893
比如，次数小于等于4

103
00:06:08,893 --> 00:06:11,115
那就能得到方程组的解析解

104
00:06:11,115 --> 00:06:14,682
最后，为了能看懂代码，还需要补充一些必要概念

105
00:06:14,682 --> 00:06:17,336
别看这里字密密麻麻的就被吓到了！

106
00:06:17,336 --> 00:06:21,297
其实，单项式和字典序必知必会，也很容易理解

107
00:06:21,297 --> 00:06:25,442
对于多项式环，就只需要知道抽象代数里有这么个概念

108
00:06:25,442 --> 00:06:28,095
为了实现消元求出Gröbner基的过程

109
00:06:28,095 --> 00:06:32,047
需要规定单项式之间的顺序关系，它会影响消元顺序

110
00:06:32,047 --> 00:06:36,240
规定方式不唯一，这期视频只介绍最容易理解的字典序

111
00:06:36,240 --> 00:06:38,509
依旧千言万语不如一个例子

112
00:06:38,509 --> 00:06:42,615
设单项式kx^ay^bz^c

113
00:06:42,615 --> 00:06:46,240
且规定x>y>z，就可以写出一个4元组

114
00:06:46,240 --> 00:06:50,432
拿到两个4元组，优先比较a的大小，a大则4元组大

115
00:06:50,432 --> 00:06:54,249
a一样则比较b，b也一样则比较c，以此类推

116
00:06:54,249 --> 00:06:56,759
最下面的代码块是非常好的例子

117
00:06:56,759 --> 00:06:59,461
把玩一下就知道字典序的规则细节了

118
00:06:59,461 --> 00:07:02,970
从左到右、从上到下，单项式就从大到小

119
00:07:02,970 --> 00:07:05,365
接下来简单介绍一下SageMath

120
00:07:05,365 --> 00:07:07,884
它是一款开源的Python数学软件

121
00:07:07,884 --> 00:07:12,461
站在了numpy、sympy等我们耳熟能详的开源巨人的肩膀上

122
00:07:12,461 --> 00:07:16,345
它在Python语法基础上增加了些语法糖，方便书写

123
00:07:16,345 --> 00:07:20,528
安装SageMath比较麻烦，这里先不讲，以后有时间再填坑~

124
00:07:20,528 --> 00:07:24,980
同学们只需要复制屏幕中间的代码去这个sagecell网站运行

125
00:07:24,980 --> 00:07:26,942
就能无痛体验SageMath

126
00:07:26,942 --> 00:07:30,249
点击网页里的Evaluate按钮就能看到结果

127
00:07:30,249 --> 00:07:32,518
如果你和我一样在用Windows

128
00:07:32,518 --> 00:07:35,884
那么你就不得不先折腾WSL和Anaconda

129
00:07:35,884 --> 00:07:38,220
这就是为什么我会鸽这么多天（借口真多

130
00:07:38,220 --> 00:07:40,567
铺垫了这么多，终于可以看代码了！

131
00:07:40,567 --> 00:07:45,461
很遗憾，万众瞩目的大语言模型没能力一次写出这里展示的代码

132
00:07:45,461 --> 00:07:47,961
所以我的讲解暂时还是有价值的

133
00:07:47,961 --> 00:07:50,740
第一个代码块很短，但已经做了不少事

134
00:07:50,740 --> 00:07:55,163
首先，定义一个三元多项式环，多项式系数都是有理数

135
00:07:55,163 --> 00:07:59,528
并规定单项式按字典序排序，变量t>x>y

136
00:07:59,528 --> 00:08:02,826
采用其他排序规则会得到不同的Gröbner基

137
00:08:02,826 --> 00:08:06,384
并不是所有Gröbner基都含有我们感兴趣的消元结果

138
00:08:06,384 --> 00:08:08,442
感兴趣的可以自己试试

139
00:08:08,442 --> 00:08:13,768
接着用多项式环的3个变量定义拉格朗日函数，并求它对每个变量的偏导

140
00:08:13,768 --> 00:08:18,567
然后构造由这三个偏导组成的多项式理想，并求它的Gröbner基

141
00:08:19,542 --> 00:08:24,280
看右边的运行结果，我们发现Gröbner基里的第3个多项式只含y

142
00:08:24,280 --> 00:08:27,432
这表明我们成功用Gröbner基完成了消元

143
00:08:27,432 --> 00:08:31,220
并且，第2个多项式告诉我们，x能用y表示出来

144
00:08:31,220 --> 00:08:35,384
接着看第二段代码，我们先运行一次，看因式分解的结果

145
00:08:35,384 --> 00:08:38,028
发现确实只能直接求3次方程的根

146
00:08:38,028 --> 00:08:41,153
于是继续写出下面那3行代码解方程

147
00:08:41,153 --> 00:08:44,682
方程有两个复数根，第三个根是我们想要的实根

148
00:08:44,682 --> 00:08:47,586
太长了，放到后两页PPT展示了

149
00:08:47,586 --> 00:08:51,480
顺便说下，像屏幕右下角的代码这样调用roots方法

150
00:08:51,480 --> 00:08:54,047
也可以直接求出多项式的解析解

151
00:08:54,047 --> 00:08:56,903
不过roots函数返回的是一个tuple

152
00:08:56,903 --> 00:09:01,499
tuple里有两个元素，第一个是根的表达式，第二个是根的重数

153
00:09:01,499 --> 00:09:04,211
最后讲讲非常容易理解的收尾代码

154
00:09:04,211 --> 00:09:07,067
solve函数返回的是一个Expression对象

155
00:09:07,067 --> 00:09:12,211
只有属于二元关系的Expression对象才能调用lhs和rhs方法

156
00:09:12,211 --> 00:09:15,567
这里我们调用rhs方法就能拿到解析解了

157
00:09:15,567 --> 00:09:20,518
代码里变量x的表达式也是从上一页PPT展示的Gröbner基拿到的

158
00:09:20,518 --> 00:09:23,297
后面4个函数都比较简单、实用

159
00:09:23,297 --> 00:09:25,768
大语言模型也会用，就不细说了

160
00:09:25,768 --> 00:09:28,855
最后顺便吐槽下latex函数的踩坑点

161
00:09:28,855 --> 00:09:33,288
出的字符串有可能在Obsidian合法，但在slidev中不合法

162
00:09:33,288 --> 00:09:35,874
bug原因可能是括号没有完全匹配

163
00:09:35,874 --> 00:09:37,961
我暂时没想到好的解决办法

164
00:09:37,961 --> 00:09:41,817
最后是靠直接问LLM帮我输出相关公式解决的

165
00:09:41,817 --> 00:09:44,826
最后来欣赏下这道钓鱼题的解析解吧！

166
00:09:44,826 --> 00:09:47,884
是的，答案需要专门新开一页来展示

167
00:09:47,884 --> 00:09:49,768
纳西妲，你被吓哭了吗？

168
00:09:49,768 --> 00:09:53,547
最后给出完整代码和探究字典序排序规则的代码

169
00:09:53,547 --> 00:09:55,355
有需要的同学可自取

