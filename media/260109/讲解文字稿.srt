1
00:00:04,000 --> 00:00:05,776
欢迎回到Hans的频道

2
00:00:05,776 --> 00:00:08,236
我们必须想象，做题人是幸福的

3
00:00:08,236 --> 00:00:12,563
今天分享如何用manim制作带递归的从夯到拉锐评视频

4
00:00:12,563 --> 00:00:15,553
如果你看过我之前两期的manim教学视频

5
00:00:15,553 --> 00:00:18,621
那么写出这期视频的代码会轻松不少

6
00:00:18,621 --> 00:00:21,515
首先我们来拆解视频标题的句子结构

7
00:00:21,515 --> 00:00:24,765
如果你已经熟悉递归算法，这一部分可以跳过

8
00:00:24,765 --> 00:00:26,880
一段代码胜过千言万语

9
00:00:26,880 --> 00:00:31,053
屏幕中间的代码非常清晰地展示了标题是怎么拼接出来的

10
00:00:31,053 --> 00:00:34,457
在浏览器中按下F12，打开开发者工具

11
00:00:34,457 --> 00:00:38,621
切到Console栏，粘贴代码，按回车，就能看到运行结果

12
00:00:38,621 --> 00:00:43,400
f1含有1个锐评和1个从夯到拉，f2是2个，f3是3个

13
00:00:43,400 --> 00:00:47,986
不难发现规律：下标是几，“锐评”和“从夯到拉”就各出现几次

14
00:00:47,986 --> 00:00:51,169
实际上，标题这句话的语序是调整过的

15
00:00:51,169 --> 00:00:54,015
原始的语序是：从夯到拉锐评某某

16
00:00:54,015 --> 00:00:56,226
这种语序当然也支持递归

17
00:00:56,226 --> 00:01:00,053
但它还能看成是循环生成的，递归味就没那么重了

18
00:01:00,053 --> 00:01:02,755
所以视频标题没有采用这种语序

19
00:01:02,755 --> 00:01:05,005
留个小作业：分析下这句话：

20
00:01:05,005 --> 00:01:07,851
给给视频评夯评拉完了给到NPC

21
00:01:07,851 --> 00:01:09,505
接下来开始看代码

22
00:01:09,505 --> 00:01:13,534
首先我们需要生成多个背景，为做出递归效果做准备

23
00:01:13,534 --> 00:01:16,015
第一个问题是：生成多少个背景？

24
00:01:16,015 --> 00:01:17,611
找规律就能确定

25
00:01:17,611 --> 00:01:20,871
普通的锐评某某从夯到拉，只需要1个背景

26
00:01:20,871 --> 00:01:24,525
锐评锐评某某从夯到拉从夯到拉，需要2个背景

27
00:01:24,525 --> 00:01:29,275
不难发现规律：标题句子里出现n个“从夯到拉”，就需要n个背景

28
00:01:29,275 --> 00:01:31,775
这里根据文案，我准备了5个背景

29
00:01:31,775 --> 00:01:36,351
之前的视频已经介绍过如何写代码生成从夯到拉的背景图

30
00:01:36,351 --> 00:01:39,746
直接找一个网站截图，然后提示词有话直说

31
00:01:39,746 --> 00:01:42,525
让通义千问帮忙用manim复刻就行

32
00:01:42,525 --> 00:01:44,986
但生成效果只是看着像回事

33
00:01:44,986 --> 00:01:47,601
古法手作调整细节的过程省不了

34
00:01:47,601 --> 00:01:49,284
可以看我之前的视频

35
00:01:49,284 --> 00:01:52,496
当时没有把生成背景的代码封装成函数

36
00:01:52,496 --> 00:01:56,467
这里为了生成多个背景，封装了函数draw_rank_list_bg

37
00:01:56,467 --> 00:02:00,967
为此，我们还需要在manim提供的setup方法里添加些全局变量

38
00:02:00,967 --> 00:02:03,871
后续代码会反反复复用到这些变量

39
00:02:03,871 --> 00:02:08,188
接下来写代码处理和上期视频一样的从夯到拉评价过程

40
00:02:08,188 --> 00:02:11,025
这期视频要展示不少技术栈的图标

41
00:02:11,025 --> 00:02:14,140
那怎么快速、方便地获取这些图标资源呢？

42
00:02:14,140 --> 00:02:18,226
直接问DeepSeek老师，就查到了这个叫devicon的开源项目

43
00:02:18,226 --> 00:02:22,573
里面有很多技术栈的图标，而且都是svg格式，太香了

44
00:02:22,573 --> 00:02:26,294
不过加载图标时踩了坑：Vite的图标含有渐变色

45
00:02:26,294 --> 00:02:29,015
加载到manim里无法正常显示颜色

46
00:02:29,015 --> 00:02:31,351
我不想在这里浪费太多时间

47
00:02:31,351 --> 00:02:34,678
直接用浏览器打开svg图标并截图

48
00:02:34,678 --> 00:02:37,592
代码改成加载图片，简单粗暴有效

49
00:02:37,592 --> 00:02:43,082
ImageMobject继承Mobject，但SVGMobject继承VMobject

50
00:02:43,082 --> 00:02:46,467
所以想打包的多个元素包含ImageMobject时

51
00:02:46,467 --> 00:02:48,775
只能用Group，不能用VGroup

52
00:02:48,775 --> 00:02:52,303
为了节省时间，我们希望一次展示多个技术栈图标

53
00:02:52,303 --> 00:02:54,784
首先确定它们的初始位置关系

54
00:02:54,784 --> 00:02:58,476
这里我选择让图标群的位置由第一个展示的图标决定

55
00:02:58,476 --> 00:03:02,053
像左下角的代码这样，先移动第一个展示的图标到

56
00:03:02,053 --> 00:03:04,400
能让图标群看着顺眼的位置

57
00:03:04,400 --> 00:03:09,217
再根据各个图标的大小来确定后续的每个图标各在哪些图标的旁边

58
00:03:09,217 --> 00:03:13,092
这里只能靠自己不断改代码，编译看效果是否顺眼

59
00:03:13,092 --> 00:03:17,573
如果希望图标群居中，像右下角的代码这样打包成Group就OK

60
00:03:17,573 --> 00:03:21,188
为了让图标依次入场，要用到manim的LaggedStart类

61
00:03:21,188 --> 00:03:26,948
lag_ratio=0.3表示在前一个动画运行30%时，下一个动画开始

62
00:03:26,948 --> 00:03:28,553
和上期视频一样

63
00:03:28,553 --> 00:03:31,784
我们希望让素材一边缩小到一行矩形的高度

64
00:03:31,784 --> 00:03:34,073
一边移动到排行榜的正确位置

65
00:03:34,073 --> 00:03:36,861
这部分代码和上期视频大同小异

66
00:03:36,861 --> 00:03:40,275
但对于第一个前往这一行的图标，我们有一个新问题

67
00:03:40,275 --> 00:03:42,755
需要先确定画面最上层的背景

68
00:03:42,755 --> 00:03:46,150
这里确定出来是bg5，原因在后面会细讲

69
00:03:46,150 --> 00:03:49,707
取标签矩形的4号下标表示把图标排到“拉完了”

70
00:03:49,707 --> 00:03:52,390
另外，我们预先打包了一个VGroup

71
00:03:52,390 --> 00:03:55,361
为后续对当前背景进行排名做准备

72
00:03:55,361 --> 00:03:57,332
这里可能会有大佬注意到

73
00:03:57,332 --> 00:04:01,496
怎么没和前面一样用LaggedStart实现元素排队入场的效果？

74
00:04:01,496 --> 00:04:05,255
因为我发现，不排第一的元素的目标位置都不好确定

75
00:04:05,255 --> 00:04:09,005
而且在运动速度较快的情况下，两者效果差不多

76
00:04:09,980 --> 00:04:12,507
解决这个技术问题的性价比并不高

77
00:04:12,457 --> 00:04:17,409
现在回答刚刚提出的问题：为什么最后加入画面的bg5位于最上层？

78
00:04:17,409 --> 00:04:22,332
根据manim讲layers的官方文档，z-index不同时，优先按z-index排

79
00:04:22,332 --> 00:04:26,361
z-index相同时，后加入画面的元素位于画面上层

80
00:04:26,361 --> 00:04:29,409
这和网页CSS的z-index规则类似

81
00:04:29,409 --> 00:04:33,880
然鹅，我在之前写代码时，错认为bg1位于画面最上层

82
00:04:33,880 --> 00:04:36,217
但视觉效果竟然完全没问题！

83
00:04:36,217 --> 00:04:39,140
我猜测原因是，在执行缩小动画时

84
00:04:39,140 --> 00:04:43,121
原本被上层背景完全覆盖的背景突然被manim拉上来了

85
00:04:43,121 --> 00:04:45,284
5层背景又长得完全一样

86
00:04:45,284 --> 00:04:49,515
这就导致缩小动画的突变过程看着就像我们期望的渐变过程

87
00:04:49,515 --> 00:04:52,630
我写了两段代码，专门展示这个突变过程

88
00:04:52,630 --> 00:04:56,909
原理很简单，给每个背景添加一个编号就能看到突变效果

89
00:04:56,909 --> 00:05:00,986
但代码比较长，这里就不完整贴出，只给两扇传送门了

90
00:05:00,986 --> 00:05:05,044
接着我们来到了本期视频的重头戏：递归锐评背景本身

91
00:05:05,044 --> 00:05:09,573
需要缩小的元素包括当前背景和一切在当前背景上面的元素

92
00:05:09,573 --> 00:05:12,169
我们要把这一切元素打包进一个Group

93
00:05:12,169 --> 00:05:14,650
并把它们放到下一层背景的某一行

94
00:05:14,650 --> 00:05:17,178
每一层递归的运动过程是一样的

95
00:05:17,178 --> 00:05:21,515
所以我抽象出了屏幕里代码展示的bg_insert_into_rank方法

96
00:05:21,515 --> 00:05:24,707
其中，to_shrink表示一切需要缩小的元素

97
00:05:24,707 --> 00:05:27,005
next_bg表示下一层背景

98
00:05:27,005 --> 00:05:31,207
label_index表示把当前元素组放在下一层背景的哪一行

99
00:05:31,207 --> 00:05:33,265
后面的参数都不太重要

100
00:05:33,265 --> 00:05:36,505
屏幕里代码展示的调用示例是第一层递归

101
00:05:36,505 --> 00:05:38,409
表示本期视频评为夯

102
00:05:38,409 --> 00:05:42,457
后续层的递归可以通过引用前面定义的to_shrink系列变量

103
00:05:42,457 --> 00:05:46,544
实现囊括一切在当前背景上面的元素的效果，很方便

104
00:05:46,544 --> 00:05:48,669
为什么说这是递归写法呢？

105
00:05:48,669 --> 00:05:51,294
把最下面代码块的to_shrink2展开

106
00:05:51,294 --> 00:05:53,775
就会发现它嵌套了好几层Group类

107
00:05:53,775 --> 00:05:56,746
没有出现递归函数，但用到了递归思想

108
00:05:56,746 --> 00:05:59,996
完整代码有330多行，这里就不贴出了

109
00:05:59,996 --> 00:06:02,650
感兴趣的大佬可以前往GitHub查看

110
00:06:02,650 --> 00:06:05,053
接着总结下本期视频的知识点

111
00:06:05,053 --> 00:06:07,688
写出本期视频的代码其实不容易

112
00:06:07,688 --> 00:06:11,092
但这里展示的知识点看着好水，就不一一读了！

113
00:06:11,092 --> 00:06:15,351
我是Hans，我正致力于为做题人的精神自留地添砖加瓦

114
00:06:15,351 --> 00:06:18,226
喜欢这期视频的话，别忘了一键三连哦

115
00:06:18,226 --> 00:06:19,371
谢谢观看

